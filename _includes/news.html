<!-- _includes/news.html -->
<!-- Displays news items from _data/news.yml -->

{% assign news_sorted = site.data.news | sort: 'date' | reverse %}

{% comment %}
Determine the limit:
1. Check if include.limit is provided and is a number
2. Check page.news_limit
3. Check site.announcements.limit
4. If no limit specified, show all
{% endcomment %}

{% assign limit_value = nil %}

{% if include.limit %}
{% if include.limit == true %}
{% if site.announcements.limit %}
{% assign limit_value = site.announcements.limit %}
{% else %}
{% assign limit_value = 5 %}
{% endif %}
{% else %}
{% assign limit_value = include.limit | plus: 0 %}
{% endif %}
{% elsif page.news_limit %}
{% assign limit_value = page.news_limit | plus: 0 %}
{% elsif site.announcements.limit and page.layout != "page" %}
{% assign limit_value = site.announcements.limit | plus: 0 %}
{% endif %}

<div class="news">
  <table>
    {% if limit_value %}
    {% assign news_to_show = news_sorted | slice: 0, limit_value %}
    {% else %}
    {% assign news_to_show = news_sorted %}
    {% endif %}

    {% for item in news_to_show %}
    <tr class="news-item">
      <td class="news-date">
        {% if site.news_date_format %}
        {% assign date_format = site.news_date_format %}
        {% else %}
        {% assign date_format = "%b %d, %Y" %}
        {% endif %}
        {{ item.date | date: date_format }}
      </td>
      <td class="news-content">
        {% if item.inline %}
        {{ item.content }}
        {% else %}
        {{ item.content }}
        {% if item.link %}
        <a href="{{ item.link }}" class="news-link">Read more Â»</a>
        {% endif %}
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
</div>